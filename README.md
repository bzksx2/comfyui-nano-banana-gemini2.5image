# Gemini ComfyUI Plugin

ä¸€ä¸ªå¼ºå¤§çš„ ComfyUI æ’ä»¶ï¼Œé›†æˆ Google Gemini API çš„å›¾åƒç”Ÿæˆå’Œç¼–è¾‘åŠŸèƒ½ã€‚æ”¯æŒçº¯æ–‡æœ¬ç”Ÿæˆå›¾åƒå’ŒåŸºäºç°æœ‰å›¾åƒçš„æ™ºèƒ½ç¼–è¾‘ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ¨ **å›¾åƒç”Ÿæˆ**: ä½¿ç”¨ Gemini æ¨¡å‹ä»æ–‡æœ¬æç¤ºç”Ÿæˆé«˜è´¨é‡å›¾åƒ
- ğŸ–¼ï¸ **å›¾åƒç¼–è¾‘**: åŸºäºè¾“å…¥å›¾åƒå’Œæ–‡æœ¬æŒ‡ä»¤è¿›è¡Œæ™ºèƒ½ç¼–è¾‘
- ğŸŒ **é•œåƒç«™æ”¯æŒ**: æ”¯æŒè‡ªå®šä¹‰APIåœ°å€ï¼Œé€‚é…å›½å†…é•œåƒç«™å’Œä»£ç†æœåŠ¡
- ğŸ”„ **æ™ºèƒ½é‡è¯•**: å†…ç½®é™æµå¤„ç†å’Œé”™è¯¯æ¢å¤æœºåˆ¶
- ğŸš€ **å¤šæ¨¡å‹æ”¯æŒ**: æ”¯æŒæœ€æ–°çš„ Gemini 2.5 å’Œ 2.0 æ¨¡å‹
- ğŸ›¡ï¸ **ç¨³å®šæ€§**: å¢å¼ºçš„é”™è¯¯å¤„ç†å’Œè¶…æ—¶ç®¡ç†

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### è·å– API Key

1. è®¿é—® [Google AI Studio](https://makersuite.google.com/app/apikey)
2. åˆ›å»ºæ–°çš„ API Key
3. åœ¨èŠ‚ç‚¹ä¸­è¾“å…¥ä½ çš„ API Key

## ğŸ“¦ èŠ‚ç‚¹è¯´æ˜

### Gemini å›¾ç‰‡ç”Ÿæˆ (GeminiImageGeneration)

ä»æ–‡æœ¬æç¤ºç”Ÿæˆå…¨æ–°å›¾åƒã€‚

**è¾“å…¥å‚æ•°:**
- `api_key`: Google Gemini API å¯†é’¥
- `prompt`: å›¾åƒç”Ÿæˆæç¤ºè¯
- `model`: é€‰æ‹©æ¨¡å‹ (gemini-2.5-flash-image-preview æˆ– gemini-2.0-flash-preview-image-generation)
- `temperature`: åˆ›é€ æ€§æ§åˆ¶ (0.0-2.0)
- `top_p`: é‡‡æ ·æ§åˆ¶ (0.0-1.0)
- `max_output_tokens`: æœ€å¤§è¾“å‡ºä»¤ç‰Œæ•°

**è¾“å‡º:**
- `image`: ç”Ÿæˆçš„å›¾åƒ (IMAGE ç±»å‹)
- `response_text`: API å“åº”æ–‡æœ¬

### Gemini å›¾ç‰‡ç¼–è¾‘ (GeminiImageEdit)

åŸºäºè¾“å…¥å›¾åƒè¿›è¡Œæ™ºèƒ½ç¼–è¾‘ã€‚

**è¾“å…¥å‚æ•°:**
- `api_key`: Google Gemini API å¯†é’¥
- `image`: è¾“å…¥å›¾åƒ (IMAGE ç±»å‹)
- `prompt`: ç¼–è¾‘æŒ‡ä»¤
- `model`: é€‰æ‹©æ¨¡å‹
- `temperature`: åˆ›é€ æ€§æ§åˆ¶
- `top_p`: é‡‡æ ·æ§åˆ¶
- `max_output_tokens`: æœ€å¤§è¾“å‡ºä»¤ç‰Œæ•°

**è¾“å‡º:**
- `edited_image`: ç¼–è¾‘åçš„å›¾åƒ (IMAGE ç±»å‹)
- `response_text`: API å“åº”æ–‡æœ¬

### Gemini é•œåƒç«™å›¾ç‰‡ç”Ÿæˆ (GeminiMirrorImageGeneration)

æ”¯æŒè‡ªå®šä¹‰APIåœ°å€çš„å›¾åƒç”ŸæˆèŠ‚ç‚¹ï¼Œé€‚é…å›½å†…é•œåƒç«™ã€‚

**è¾“å…¥å‚æ•°:**
- `api_url`: è‡ªå®šä¹‰APIåœ°å€ (å¦‚: https://ai.comfly.chat)
- `api_key`: API å¯†é’¥
- `prompt`: å›¾åƒç”Ÿæˆæç¤ºè¯
- `model`: é€‰æ‹©æ¨¡å‹
- `temperature`: åˆ›é€ æ€§æ§åˆ¶
- `top_p`: é‡‡æ ·æ§åˆ¶
- `max_output_tokens`: æœ€å¤§è¾“å‡ºä»¤ç‰Œæ•°

**è¾“å‡º:**
- `image`: ç”Ÿæˆçš„å›¾åƒ (IMAGE ç±»å‹)
- `response_text`: API å“åº”æ–‡æœ¬

### Gemini é•œåƒç«™å›¾ç‰‡ç¼–è¾‘ (GeminiMirrorImageEdit)

æ”¯æŒè‡ªå®šä¹‰APIåœ°å€çš„å›¾åƒç¼–è¾‘èŠ‚ç‚¹ï¼Œé€‚é…å›½å†…é•œåƒç«™ã€‚

**è¾“å…¥å‚æ•°:**
- `api_url`: è‡ªå®šä¹‰APIåœ°å€ (å¦‚: https://ai.comfly.chat)
- `api_key`: API å¯†é’¥
- `image`: è¾“å…¥å›¾åƒ (IMAGE ç±»å‹)
- `prompt`: ç¼–è¾‘æŒ‡ä»¤
- `model`: é€‰æ‹©æ¨¡å‹
- `temperature`: åˆ›é€ æ€§æ§åˆ¶
- `top_p`: é‡‡æ ·æ§åˆ¶
- `max_output_tokens`: æœ€å¤§è¾“å‡ºä»¤ç‰Œæ•°

**è¾“å‡º:**
- `edited_image`: ç¼–è¾‘åçš„å›¾åƒ (IMAGE ç±»å‹)
- `response_text`: API å“åº”æ–‡æœ¬

## ğŸ”§ æŠ€æœ¯ç‰¹æ€§

### æ™ºèƒ½é‡è¯•æœºåˆ¶

- **æŒ‡æ•°é€€é¿**: è‡ªåŠ¨è°ƒæ•´é‡è¯•é—´éš”
- **é™æµå¤„ç†**: é’ˆå¯¹ 429 é”™è¯¯çš„ç‰¹æ®Šå¤„ç†
- **é”™è¯¯åˆ†ç±»**: æ ¹æ®ä¸åŒé”™è¯¯ç±»å‹é‡‡ç”¨ä¸åŒç­–ç•¥

### å›¾åƒå¤„ç†

- **æ ¼å¼è½¬æ¢**: è‡ªåŠ¨å¤„ç† RGB/RGBA è½¬æ¢
- **Base64 ç¼–ç **: é«˜æ•ˆçš„å›¾åƒæ•°æ®ä¼ è¾“
- **è´¨é‡ä¼˜åŒ–**: 95% JPEG è´¨é‡ä¿è¯

### é”™è¯¯å¤„ç†

- **è¯¦ç»†æ—¥å¿—**: å®Œæ•´çš„æ“ä½œè¿‡ç¨‹è®°å½•
- **å‹å¥½æç¤º**: æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®
- **ä¼˜é›…é™çº§**: å¤±è´¥æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ

## ğŸ“‹ ä¾èµ–é¡¹

```
torch>=1.9.0          # æ·±åº¦å­¦ä¹ æ¡†æ¶
numpy>=1.21.0         # æ•°å€¼è®¡ç®—
Pillow>=8.0.0         # å›¾åƒå¤„ç†
requests>=2.25.0      # HTTP è¯·æ±‚
google-genai>=0.3.0   # Google AI SDK
```

## ğŸ› ï¸ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€å›¾åƒç”Ÿæˆ

```python
# åœ¨ ComfyUI ä¸­æ·»åŠ  "Gemini å›¾ç‰‡ç”Ÿæˆ" èŠ‚ç‚¹
# è®¾ç½®å‚æ•°:
api_key = "your_gemini_api_key"
prompt = "A serene mountain landscape at sunset with a lake reflection"
model = "gemini-2.5-flash-image-preview"
```

### å›¾åƒç¼–è¾‘

```python
# åœ¨ ComfyUI ä¸­æ·»åŠ  "Gemini å›¾ç‰‡ç¼–è¾‘" èŠ‚ç‚¹
# è¿æ¥è¾“å…¥å›¾åƒå¹¶è®¾ç½®å‚æ•°:
prompt = "Add a rainbow in the sky"
```

### ä½¿ç”¨é•œåƒç«™

```python
# åœ¨ ComfyUI ä¸­æ·»åŠ  "Gemini é•œåƒç«™å›¾ç‰‡ç”Ÿæˆ" èŠ‚ç‚¹
# è®¾ç½®è‡ªå®šä¹‰APIåœ°å€:
api_url = "https://ai.comfly.chat"  # æˆ–å…¶ä»–é•œåƒç«™åœ°å€
api_key = "your_api_key"
prompt = "A beautiful sunset over the ocean"
```

### ä½¿ç”¨ OpenAI æ ¼å¼é•œåƒç«™

```python
# åœ¨ ComfyUI ä¸­æ·»åŠ  "Gemini OpenAIæ ¼å¼é•œåƒç«™å›¾ç‰‡ç”Ÿæˆ" èŠ‚ç‚¹
# è®¾ç½® OpenAI æ ¼å¼APIåœ°å€:
api_url = "https://ai.t8star.cn"  # OpenAI æ ¼å¼é•œåƒç«™
api_key = "your_api_key"
model = "gpt-4o-image"  # æ”¯æŒå›¾åƒçš„æ¨¡å‹
prompt = "ç”Ÿæˆå›¾ç‰‡: ä¸€ä¸ªç¾ä¸½çš„å±±æ™¯"
```

## ğŸŒ æ”¯æŒçš„é•œåƒç«™

æ’ä»¶æ”¯æŒä¸¤ç§APIæ ¼å¼çš„é•œåƒç«™ï¼š

### Gemini åŸç”Ÿæ ¼å¼é•œåƒç«™
- `https://ai.comfly.chat` - ComflyAI é•œåƒç«™
- `https://api.openai-proxy.com` - ä»£ç†æœåŠ¡
- å…¶ä»–å…¼å®¹ Gemini API æ ¼å¼çš„é•œåƒæœåŠ¡

### OpenAI æ ¼å¼é•œåƒç«™
- `https://ai.t8star.cn` - T8Star é•œåƒç«™
- `https://api.chatanywhere.com.cn` - ChatAnywhere
- å…¶ä»–å…¼å®¹ OpenAI Chat Completions API çš„é•œåƒæœåŠ¡

### é•œåƒç«™é…ç½®è¯´æ˜

1. **å®Œæ•´URL**: å¦‚æœæä¾›å®Œæ•´çš„APIç«¯ç‚¹ï¼Œæ’ä»¶ä¼šç›´æ¥ä½¿ç”¨
   ```
   https://ai.comfly.chat/v1beta/models/gemini-2.5-flash-image-preview:generateContent
   ```

2. **åŸºç¡€URL**: å¦‚æœåªæä¾›åŸºç¡€åŸŸåï¼Œæ’ä»¶ä¼šè‡ªåŠ¨æ„å»ºå®Œæ•´è·¯å¾„
   ```
   https://ai.comfly.chat
   ```

3. **URLéªŒè¯**: æ’ä»¶ä¼šè‡ªåŠ¨éªŒè¯URLæ ¼å¼çš„æœ‰æ•ˆæ€§

### OpenAI æ ¼å¼é…ç½®è¯´æ˜

1. **å®Œæ•´URL**: å¦‚æœæä¾›å®Œæ•´çš„APIç«¯ç‚¹ï¼Œæ’ä»¶ä¼šç›´æ¥ä½¿ç”¨
   ```
   https://ai.t8star.cn/v1/chat/completions
   ```

2. **åŸºç¡€URL**: å¦‚æœåªæä¾›åŸºç¡€åŸŸåï¼Œæ’ä»¶ä¼šè‡ªåŠ¨æ„å»ºå®Œæ•´è·¯å¾„
   ```
   https://ai.t8star.cn
   ```

3. **æ¨¡å‹é€‰æ‹©**: ä½¿ç”¨æ”¯æŒå›¾åƒåŠŸèƒ½çš„æ¨¡å‹åç§°
   - `gpt-4o-image` - æ”¯æŒå›¾åƒç”Ÿæˆå’Œç¼–è¾‘
   - `gpt-4-vision-preview` - æ”¯æŒå›¾åƒç†è§£å’Œç¼–è¾‘
   - å…¶ä»–é•œåƒç«™ç‰¹å®šçš„å›¾åƒæ¨¡å‹

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **API é…é¢**: æ³¨æ„ Google Gemini API çš„ä½¿ç”¨é™åˆ¶
2. **ç½‘ç»œè¿æ¥**: ç¡®ä¿ç¨³å®šçš„ç½‘ç»œè¿æ¥
3. **å›¾åƒå¤§å°**: å¤§å›¾åƒå¯èƒ½éœ€è¦æ›´é•¿å¤„ç†æ—¶é—´
4. **æ¨¡å‹é€‰æ‹©**: ä¸åŒæ¨¡å‹æœ‰ä¸åŒçš„ç‰¹æ€§å’Œé™åˆ¶

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**API Key é”™è¯¯**
- ç¡®ä¿ API Key æ ¼å¼æ­£ç¡®ä¸”æœ‰æ•ˆ
- æ£€æŸ¥ API Key æƒé™è®¾ç½®

**429 é™æµé”™è¯¯**
- ç­‰å¾…æ›´é•¿æ—¶é—´å†è¯•
- æ£€æŸ¥ API é…é¢è®¾ç½®
- è€ƒè™‘å‡çº§ API è®¡åˆ’

**ç½‘ç»œè¶…æ—¶**
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- å¢åŠ è¶…æ—¶æ—¶é—´è®¾ç½®

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ªå¼€æºè®¸å¯è¯ã€‚ä½¿ç”¨å‰è¯·ç¡®ä¿éµå®ˆ Google Gemini API çš„ä½¿ç”¨æ¡æ¬¾ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

---

**æ³¨æ„**: ä½¿ç”¨æœ¬æ’ä»¶éœ€è¦æœ‰æ•ˆçš„ Google Gemini API å¯†é’¥ã€‚è¯·ç¡®ä¿éµå®ˆç›¸å…³çš„ä½¿ç”¨æ¡æ¬¾å’Œé™åˆ¶ã€‚